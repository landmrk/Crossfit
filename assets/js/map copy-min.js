mapboxgl.accessToken="pk.eyJ1IjoibGFuZG1yayIsImEiOiJjajV1dzZqemkxczA2MndxdHZrN3I0dGhtIn0.OQf_LxW3LV68pDjF4pTxdQ";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/landmrk/ckcd73d8e7sca1imtabjdx8hr",zoom:4,pitch:30});function setChallengeMarkers(e){map.addSource("places",{type:"geojson",data:e,cluster:!1}),map.loadImage("../assets/imgs/hotspot-ball.png",((e,a)=>{if(e)throw e;map.addImage("hotspot",a)})),map.addLayer({id:"places",type:"symbol",source:"places",layout:{"icon-image":"hotspot","icon-allow-overlap":!0,"icon-size":.5,"icon-offset":[0,-77]}}),map.on("click","places",(function(e){var a=e.features[0].geometry.coordinates.slice();const{description:o,image:t}=e.features[0].properties,n=`<img src="${t}" width="140" /> <p>${o}</p> <strong>#12Challenges</strong>`;for(;Math.abs(e.lngLat.lng-a[0])>180;)a[0]+=e.lngLat.lng>a[0]?360:-360;(new mapboxgl.Popup).setLngLat(a).setHTML(n).addTo(map)})),map.on("mouseenter","places",(function(){map.getCanvas().style.cursor="pointer"})),map.on("mouseleave","places",(function(){map.getCanvas().style.cursor=""}))}function setInfoMarkers(e){map.addSource("infoMarkers",{type:"geojson",data:e,cluster:!1}),map.loadImage("../assets/imgs/hotspot-info.png",((e,a)=>{if(e)throw e;map.addImage("hotspot2",a)})),map.addLayer({id:"infoMarkers",type:"symbol",source:"infoMarkers",layout:{"icon-image":"hotspot2","icon-allow-overlap":!0,"icon-size":.5}}),map.on("click","infoMarkers",(function(e){var a=e.features[0].geometry.coordinates.slice();const{heading1:o,heading2:t,description:n}=e.features[0].properties,s=`${o} <strong>${t}</strong> <p>${n}</p>`;for(;Math.abs(e.lngLat.lng-a[0])>180;)a[0]+=e.lngLat.lng>a[0]?360:-360;(new mapboxgl.Popup).setLngLat(a).setHTML(s).addTo(map)})),map.on("mouseenter","infoMarkers",(function(){map.getCanvas().style.cursor="pointer"})),map.on("mouseleave","infoMarkers",(function(){map.getCanvas().style.cursor=""}))}function setCovidMarkers(e){map.addSource("covidMarkers",{type:"geojson",data:e,cluster:!1}),map.loadImage("../assets/imgs/hotspot-fact.png",((e,a)=>{if(e)throw e;map.addImage("hotspot3",a)})),map.addLayer({id:"covidMarkers",type:"symbol",source:"covidMarkers",layout:{"icon-image":"hotspot3","icon-allow-overlap":!0,"icon-size":.5}}),map.on("click","covidMarkers",(function(e){var a=e.features[0].geometry.coordinates.slice();const{description1:o,description2:t}=e.features[0].properties,n=`<p>${o}</p> <p>${t}</p>`;for(;Math.abs(e.lngLat.lng-a[0])>180;)a[0]+=e.lngLat.lng>a[0]?360:-360;(new mapboxgl.Popup).setLngLat(a).setHTML(n).addTo(map)})),map.on("mouseenter","covidMarkers",(function(){map.getCanvas().style.cursor="pointer"})),map.on("mouseleave","covidMarkers",(function(){map.getCanvas().style.cursor=""}))}map.on("load",(function(){d3.json("https://opensheet.elk.sh/1opFPe_w7wU2PMkAWtsvbNWHvZtxzMjM7l2pxne3Qswc/locations",(function(e,a){const{route:o,reachedRoute:t,challengeMarkers:n,infoMarkers:s,covidMarkers:r,metadata:i}=a;if(e)throw e;localStorage.setItem("metadata",i);const{daysRemaining:p,justGiving:c,distanceRan:l}=i;document.getElementById("daysRemaining").innerHTML=p,document.getElementById("justGiving").innerHTML=c,document.getElementById("distanceRan").innerHTML=l;const{coordinates:m}=t.features[0].geometry,d=[m[0]];let g=t;g.features[0].geometry.coordinates=d,map.addSource("routeStatic",{type:"geojson",data:o}),map.addLayer({id:"routeStatic",type:"line",source:"routeStatic",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#FBDC01","line-opacity":1,"line-width":8}}),map.addSource("trace",{type:"geojson",data:g}),map.addLayer({id:"trace",type:"line",source:"trace",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#E5321E","line-opacity":1,"line-width":8}}),map.jumpTo({center:d[0],zoom:4}),map.setPitch(30);var u=0,f=window.setInterval((function(){u<m.length?(g.features[0].geometry.coordinates.push(m[u]),map.getSource("trace").setData(g),map.panTo(m[u]),u++):window.clearInterval(f)}),300);map.loadImage("../assets/imgs/hotspot-info.png",((e,a)=>{if(e)throw e;map.addImage("info",a)})),map.loadImage("../assets/imgs/hotspot-ball.png",((e,a)=>{if(e)throw e;map.addImage("ball",a)})),map.loadImage("../assets/imgs/hotspot-fact.png",((e,a)=>{if(e)throw e;map.addImage("fact",a)})),setChallengeMarkers(n),setInfoMarkers(s),setCovidMarkers(r),map.addControl(new mapboxgl.NavigationControl)}))}));